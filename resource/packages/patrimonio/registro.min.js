var REGISTRO=REGISTRO||{},urlController=Request.BaseUrl+"/"+Request.UrlHash.m;REGISTRO.registro=function(e){"use strict";var t=e.extend(!0,{},MPC.config),a=e("#formu_registro_bienes"),s=(e("#chk_empresa"),e("#cbo_empresa"),e("#txt_empresa"),e("#upImage"),e("#clearForm"),e("#solicitante_foto"),e("#cropping"),e("#NUMERO_DOCUMENTO_PERSONA"),e("#REGISTRAR_PERSONA")),o=(e("#id_departamento"),e("#ID_CUENTA")),n=(e("#id_provincia"),e("#id_distrito"),e("#imagePreview"),e("#ID_GERENCIA_GENERAL")),i=e("#ID_SUBGERENCIA"),r={errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){var t=e("#FECHA_PECOSA").val(),s=e("#FECHA_ADQUISICION").val(),o=e("#FECHA_INICIO_ASEGURADO").val(),n=e("#FECHA_FIN_ASEGURADO").val();return s>=t?(_("body","LA FECHA DE PECOSA DEBE SER POSTERIOR A LA F.ADQUISICIÓN","danger","bar"),!1):o>n?(_("body","FECHAS INVALIDAS SEGURO","danger","bar"),!1):void bootbox.confirm({title:"Atención!",message:"<div class='text-center'><h5>¿Los datos ingresados son los correctos?</h5></div>",className:"modal fade stick-up",size:"small",buttons:{confirm:{label:"Si",className:"btn-success"},cancel:{label:"No",className:"btn-default"}},callback:function(t){if(t){var s=!0;s&&e.ajax({type:"post",dataType:"json",url:urlController+"/principal/save",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:a.serialize(),success:function(t){t.estado===!0&&(_("body","REGISTRADO","success","bar"),a[0].reset(),e("#ID_TIPO_CAUSAL").val(null).trigger("change"),e("#ID_DOC_ADQUISICION").val(null).trigger("change"),e("#ID_USO_CUENTA").val(null).trigger("change"),e("#ID_CUENTA").val(null).trigger("change"),e("#ID_ESTADO_BIEN").val(null).trigger("change"),e("#ID_CONDICION").val(null).trigger("change"),e("#ID_ENTIDAD").val(null).trigger("change"),e("#ID_LOCAL").val(null).trigger("change"),e("#ID_GERENCIA_GENERAL").val(null).trigger("change"),e("#ID_SUBGERENCIA").val(null).trigger("change"),e("#ID_RESPONSABLE").val(null).trigger("change"),e("#SI").trigger("click"),e("#NO").trigger("click"))}})}}})},rules:{skills:"required",startDate:{dateBefore:"#endDate"},endDate:{dateAfter:"#startDate",required:!0}},messages:{skills:"Campo requerido"}},l=function(){c(),a.validate(r),E(),u(),N(),t.datepicker.startView=2},c=function(){i.on("change",function(){e.post(Request.BaseUrl+"/"+Request.UrlHash.m+"/response/getSubResponsable",{ID_SUBGERENCIA:e(this).val()},function(t){e("#ID_RESPONSABLE").html(t.option)},"json")})},E=function(){n.on("change",function(){e.post(Request.BaseUrl+"/"+Request.UrlHash.m+"/response/getSubGerencia",{ID_GERENCIA:e(this).val()},function(t){e("#ID_SUBGERENCIA").html(t.option),e("#ID_RESPONSABLE").html(t.option_responsable)},"json")})},u=function(){s.on("click",function(){e.post(Request.BaseUrl+"/patrimonio/principal/NuevaPersona",function(e){bootbox.dialog({closeButton:!1,message:e.layer}),A()},"json")})},A=function(){e("#btn_close").on("click",function(){bootbox.hideAll()}),e("#ID_GERENCIA").on("change",function(){e.post(Request.BaseUrl+"/patrimonio/response/getSubGerencia",{ID_GERENCIA:e(this).val()},function(t){e("#ID_SUB_GERENCIA").html(t.option)},"json")}),e("#NUMERO_DOCUMENTO_PERSONA").on("blur",function(){{var t=e(this).val();e("#TIPO_DOCUMENTO_PERSONA").val()}e.post(Request.BaseUrl+"/patrimonio/response/searchpersona",{numero_documento:t},function(t){if(t.STATE)if(t.RESPONSABLE){e(this).val("");var a=[];a.message='<div class="text-center"><i class="fa fa-warning"></i> Persona ya registrada</div>',a.style="flip",a.position="top",a.type="warning",a.showClose=!0,e(".modal-content").pgNotification(a).show()}else{var a=[];a.message='<div class="text-center"><i class="fa fa-check"></i> Resultados encontrados</div>',a.style="flip",a.position="top",a.type="success",a.showClose=!0,e(".modal-content").pgNotification(a).show(),e("#ID_PERSONA").val(t.PERSONA.ID_PERSONA),e("#NOMBRES_PERSONA").val(t.PERSONA.NOMBRES_PERSONA),e("#APELLIDO_PATERNO_PERSONA").val(t.PERSONA.APELLIDO_PATERNO_PERSONA),e("#APELLIDO_MATERNO_PERSONA").val(t.PERSONA.APELLIDO_MATERNO_PERSONA),e("#NOMBRES_PERSONA").attr("readonly",""),e("#APELLIDO_PATERNO_PERSONA").attr("readonly",""),e("#APELLIDO_MATERNO_PERSONA").attr("readonly","")}else{var a=[];a.message='<div class="text-center"><i class="fa fa-warning"></i> No se encontraron resultados</div>',a.style="flip",a.position="top",a.type="danger",a.showClose=!0,e(".modal-content").pgNotification(a).show()}},"json")}),e("#frm_respo").on("submit",function(){return e.post(Request.BaseUrl+"/gerencias/responsables/save",e("#frm_respo").serialize(),function(t){if(t.STATE){bootbox.hideAll();var a=[];a.message='<div class="text-center"><i class="fa fa-check"></i> Datos guardados</div>',a.style="flip",a.position="top",a.type="success",a.showClose=!0,e("body").pgNotification(a).show()}else{var a=[];a.message='<div class="text-center"><i class="fa fa-warning"></i> No se pudieron guardar los datos</div>',a.style="flip",a.position="top",a.type="danger",a.showClose=!0,e(".modal-content").pgNotification(a).show(),e("#dv_save").html('<button type="button" class="btn btn-danger" id="btn_close"><i class="fa fa-close"></i> Cancelar</button><button type="submit" class="btn btn-info" id="btn_save"><i class="fa fa-save"></i> Guardar</button>')}},"json"),!1})},N=function(){o.on("change",function(){var t=(e("#numero_documento").val(),e("#CODIGO_GRUPO").val()),a=e("#CODIGO_CLASE").val(),s=e("#ID_CUENTA").val();e.post(Request.BaseUrl+"/"+Request.UrlHash.m+"/response/getNumCuenta",{cod_grupo:t,cod_clase:a,tipo_cuenta:s},function(t){e("#NUM_CUENTA_CONTABLE").val(t.cuenta),e("#NUM_CUENTA").text("NUMERO CUENTA CONTABLE: "+t.cuenta)},"json")})},_=function(t,a,s,o){e(t).pgNotification({style:o,showClose:!1,message:"<center><b>"+a+"</b></center>",position:"top",timeout:3e3,type:s}).show()};return{init:l}}(window.jQuery),function(){REGISTRO.registro.init()}(window.jQuery);