var GERENCIAS=GERENCIAS||{};GERENCIAS.gerencia=function(e){"use strict";var a=e("table#tb_gerencias"),t=function(){e("#btn_search").on("click",function(){a.bootstrapTable("refresh")})},i=function(){var t=e.extend(!0,{},e.extend(!0,{},MPC.config).bootstrapTable);t.idField="ID_GERENCIA",t.search=!1,t.url=Request.BaseUrl+"/gerencias/gerencias/list",t.queryParams=function(a){return a.filter_type=e("#cbo_filter_type").val(),a.filter_value=e("#txt_filter_value").val(),a.filter_year=e("#txt_filter_year").val(),a},t.columns=[{field:"DESCRIPCION_GERENCIA",title:"DESCRIPCIÃ“N",align:"center",sortable:!0,width:"*"},{field:"ABREVIATURA_GERENCIA",title:"ABREVIATURA",align:"center",sortable:!0,width:"*"},{field:"DESCRIPCION_GERENCIA_PADRE",title:"GERENCIA PADRE",align:"center",sortable:!0,width:"*"},{field:"action",title:" ACCIONES",align:"center",width:"100px",formatter:n,events:{"click .edit":o}}],a.bootstrapTable(t)},n=function(e,a){var t='<button id="btn-edit-'+a.ID_GERENCIA+'" class="btn-actions edit btn btn-xs btn-complete" data-id="'+a.ID_GERENCIA+'" title="Editar Registro"><i class="fa fa-edit"></i></button>&nbsp;';return t},r=function(){e("#btn_new_gerencia").on("click",function(){e.post(Request.BaseUrl+"/gerencias/gerencias/gerencia",{},function(e){bootbox.dialog({closeButton:!1,message:e.layer}),s()},"json")})},o=function(a,t,i){e.post(Request.BaseUrl+"/gerencias/gerencias/gerencia",{id:i.ID_GERENCIA},function(e){bootbox.dialog({closeButton:!1,message:e.layer}),s()},"json")},s=function(){l(),e("#btn_close").on("click",function(){bootbox.hideAll()}),e("#cbo_gerencia_responsable").select2({dropdownParent:e(".modal"),width:"100%"}),e("#cbo_gerencia_gerencia_padre").select2({dropdownParent:e(".modal"),width:"100%"}),e("#chk_gerencia_padre").on("click",function(){e(this).is(":checked")?(e("#dv_gerencia_padre").addClass("hidden"),e("#cbo_gerencia_gerencia_padre").removeAttr("required","")):(e("#dv_gerencia_padre").removeClass("hidden"),e("#cbo_gerencia_gerencia_padre").attr("required",!0))}),e(".responsable").on("change blur",function(){""!=e(".responsable").val()?(e(".responsable").attr("required",""),e("#lb_responsable").html('<b>Responsable</b> <label style="color:red">*</label></label>'),e("#lb_contrato").html('<b>Modalidad de Contrato</b> <label style="color:red">*</label></label>'),e("#lb_fechas").html('<b>Periodo de Responsable</b> <label style="color:red">*</label></label>')):(e(".responsable").removeAttr("required",""),e("#lb_responsable").html("<b>Responsable</b></label>"),e("#lb_contrato").html("<b>Modalidad de Contrato</b></label>"),e("#lb_fechas").html("<b>Periodo de Responsable</b></label>"))}),e(".date_range").on("blur",function(){e("#txt_gerencia_fecha_inicio").val()>e("#txt_gerencia_fecha_fin").val()&&e("#txt_gerencia_fecha_fin").val(e("#txt_gerencia_fecha_inicio").val())}),e("#txt_gerencia_descripcion").on("keyup",function(){e.post(Request.BaseUrl+"/gerencias/gerencias/validatedescripcion",{name:e("#txt_gerencia_descripcion").val(),id:e("#txt_gerencia_id").val()},function(a){a.STATE?e("#lb_descripcion_error").removeClass("hidden"):e("#lb_descripcion_error").addClass("hidden")},"json")}),e("#txt_gerencia_abreviatura").on("keyup",function(){e.post(Request.BaseUrl+"/gerencias/gerencias/validateabreviatura",{name:e("#txt_gerencia_abreviatura").val(),id:e("#txt_gerencia_id").val()},function(a){a.STATE?e("#lb_abreviatura_error").removeClass("hidden"):e("#lb_abreviatura_error").addClass("hidden")},"json")}),e("#frm_gerencia").on("submit",function(){return e("#lb_descripcion_error").hasClass("hidden")&&e("#lb_abreviatura_error").hasClass("hidden")?(e("#dv_save").html('Guardando... por favor espere<br><img class="image-responsive-height demo-mw-50" src="/ggdelc/themes/01//img/demo/progress.svg" alt="Progress">'),e.post(Request.BaseUrl+"/gerencias/gerencias/save",e("#frm_gerencia").serialize(),function(t){if(t.STATE){a.bootstrapTable("refresh"),bootbox.hideAll();var i=[];i.message='<div class="text-center"><i class="fa fa-check"></i> Datos guardados</div>',i.style="flip",i.position="top",i.type="success",i.showClose=!0,e("body").pgNotification(i).show()}else{var i=[];i.message='<div class="text-center"><i class="fa fa-warning"></i> No se pudieron guardar los datos</div>',i.style="flip",i.position="top",i.type="danger",i.showClose=!0,e(".modal-content").pgNotification(i).show(),e("#dv_save").html('<button type="button" class="btn btn-danger" id="btn_close"><i class="fa fa-close"></i> Cancelar</button><button type="submit" class="btn btn-info" id="btn_save"><i class="fa fa-save"></i> Guardar</button>')}},"json"),!1):!1})},l=function(){function a(e){var a=e.which?e.which:event.keyCode;return 45==a||32==a?!0:48>a||a>57?!1:!0}function t(e){var a=e.which?e.which:event.keyCode;return 45==a||32==a||46==a?!0:48>a||a>57?!1:!0}e(".mayusculas").keyup(function(){e(this).val(e(this).val().toUpperCase())}),e(".validar_numeros").keypress(function(e){return a(e,this)}),e(".validar_decimales").keypress(function(e){return t(e,this)})};return{init:function(){i(),t(),r()}}}(window.jQuery),function(){GERENCIAS.gerencia.init()}(window.jQuery);