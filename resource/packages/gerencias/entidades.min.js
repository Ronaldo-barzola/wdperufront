var ENTIDADES=ENTIDADES||{};ENTIDADES.entidad=function(e){"use strict";var t=e("table#tb_entidades"),i=function(){e("#btn_search").on("click",function(){t.bootstrapTable("refresh")})},n=function(){var i=e.extend(!0,{},e.extend(!0,{},MPC.config).bootstrapTable);i.idField="ID_ENTIDAD",i.search=!1,i.url=Request.BaseUrl+"/gerencias/entidades/list",i.queryParams=function(t){return t.filter_type=e("#cbo_filter_type").val(),t.filter_value=e("#txt_filter_value").val(),t.filter_year=e("#txt_filter_year").val(),t},i.columns=[{field:"RUC_ENTIDAD",title:"RUC",align:"center",sortable:!0,width:"*"},{field:"NOMBRE_ENTIDAD",title:"NOMBRE",align:"center",sortable:!0,width:"*"},{field:"NOMBRE_DEPARTAMENTO",title:"DEPARTAMENTO",align:"center",sortable:!0,width:"*"},{field:"NOMBRE_PROVINCIA",title:"PROVINCIA",align:"center",sortable:!0,width:"*"},{field:"NOMBRE_DISTRITO",title:"DISTRITO",align:"center",sortable:!0,width:"*"},{field:"action",title:" ACCIONES",align:"center",width:"100px",formatter:o,events:{"click .edit":s}}],t.bootstrapTable(i)},o=function(e,t){var i='<button id="btn-edit-'+t.ID_ENTIDAD+'" class="btn-actions edit btn btn-xs btn-complete" data-id="'+t.ID_ENTIDAD+'" title="Editar Registro"><i class="fa fa-edit"></i></button>&nbsp;';return i},a=function(){e("#btn_new_entidad").on("click",function(){e.post(Request.BaseUrl+"/gerencias/entidades/entidad",{},function(e){bootbox.dialog({closeButton:!1,message:e.layer}),r()},"json")})},s=function(t,i,n){e.post(Request.BaseUrl+"/gerencias/entidades/entidad",{id:n.ID_ENTIDAD},function(e){bootbox.dialog({closeButton:!1,message:e.layer}),r()},"json")},r=function(){d(),e("#btn_close").on("click",function(){bootbox.hideAll()}),e("#txt_entidad_ruc").on("blur",function(){e.post(Request.BaseUrl+"/gerencias/response/searchempresa",{name:e("#txt_entidad_ruc").val(),id:e("#txt_entidad_id").val()},function(t){e("#txt_entidad_nombre").val(""),t.STATE?t.ENTIDAD?e("#lb_ruc_error").removeClass("hidden"):(e("#lb_ruc_error").addClass("hidden"),e("#txt_entidad_nombre").val(t.EMPRESA.RAZON_SOCIAL_EMPRESA)):e("#lb_ruc_error").addClass("hidden")},"json")}),e("#frm_entidad").on("submit",function(){return e("#lb_ruc_error").hasClass("hidden")?(e("#dv_save").html('Guardando... por favor espere<br><img class="image-responsive-height demo-mw-50" src="/ggdelc/themes/01//img/demo/progress.svg" alt="Progress">'),e.post(Request.BaseUrl+"/gerencias/entidades/save",e("#frm_entidad").serialize(),function(i){if(i.STATE){t.bootstrapTable("refresh"),bootbox.hideAll();var n=[];n.message='<div class="text-center"><i class="fa fa-check"></i> Datos guardados</div>',n.style="flip",n.position="top",n.type="success",n.showClose=!0,e("body").pgNotification(n).show()}else{var n=[];n.message='<div class="text-center"><i class="fa fa-warning"></i> No se pudieron guardar los datos</div>',n.style="flip",n.position="top",n.type="danger",n.showClose=!0,e(".modal-content").pgNotification(n).show(),e("#dv_save").html('<button type="button" class="btn btn-danger" id="btn_close"><i class="fa fa-close"></i> Cancelar</button><button type="submit" class="btn btn-info" id="btn_save"><i class="fa fa-save"></i> Guardar</button>')}},"json"),!1):!1})},d=function(){function t(e){var t=e.which?e.which:event.keyCode;return 45==t||32==t?!0:48>t||t>57?!1:!0}function i(e){var t=e.which?e.which:event.keyCode;return 45==t||32==t||46==t?!0:48>t||t>57?!1:!0}e("#cbo_entidad_departamento").on("change",function(){var t=this.value;""!=t?e.post(Request.BaseUrl+"/gerencias/response/searchprovincias",{id:t},function(t){e("#cbo_entidad_provincia").removeAttr("disabled",!0),e("#cbo_entidad_provincia").html(t.option),e("#cbo_entidad_distrito").html('<option value="">Seleccione</option>')},"json"):(e("#cbo_entidad_provincia").html("<option value=''>Seleccione</option>"),e("#cbo_entidad_distrito").html("<option value=''>Seleccione</option>"))}),e("#cbo_entidad_provincia").on("change",function(){var t=this.value;""!=t?e.post(Request.BaseUrl+"/gerencias/response/searchdistritos",{id:t},function(t){e("#cbo_entidad_distrito").html(t.option)},"json"):e("#cbo_entidad_distrito").html("<option value=''>Seleccione</option>")}),e(".mayusculas").keyup(function(){e(this).val(e(this).val().toUpperCase())}),e(".validar_numeros").keypress(function(e){return t(e,this)}),e(".validar_decimales").keypress(function(e){return i(e,this)})};return{init:function(){n(),i(),a()}}}(window.jQuery),function(){ENTIDADES.entidad.init()}(window.jQuery);